{% extends 'admin/page/base.html' %}
{% block title %}
    Gestión de Ventas - Panel de Administración
{% endblock %}
{% block content %}
<div class="container mx-auto px-4 py-6">
    <!-- Encabezado con título y estadísticas -->
    <div class="mb-8">
        <div class="flex flex-col md:flex-row md:items-center justify-between mb-6">
            <div>
                <h1 class="text-2xl font-bold text-gray-800">Gestión de Ventas</h1>
                <p class="text-gray-600 mt-1">Visualiza y gestiona todas las ventas completadas</p>
            </div>
            <div class="mt-4 md:mt-0">
                <button id="refresh-btn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center transition duration-200">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                    </svg>
                    Actualizar
                </button>
            </div>
        </div>
        
        <!-- Tarjetas de estadísticas -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
            <div class="bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl shadow-lg p-6 text-white">
                <div class="flex items-center">
                    <div class="p-3 rounded-full bg-blue-400 bg-opacity-30">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path>
                        </svg>
                    </div>
                    <div class="ml-4">
                        <h2 class="text-lg font-semibold text-blue-100">Total Ventas</h2>
                        <p class="text-2xl font-bold text-white" id="total-ventas">0</p>
                    </div>
                </div>
            </div>
            
            <div class="bg-gradient-to-r from-green-500 to-green-600 rounded-xl shadow-lg p-6 text-white">
                <div class="flex items-center">
                    <div class="p-3 rounded-full bg-green-400 bg-opacity-30">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </div>
                    <div class="ml-4">
                        <h2 class="text-lg font-semibold text-green-100">Ingresos Totales</h2>
                        <p class="text-2xl font-bold text-white" id="total-ingresos">$0</p>
                    </div>
                </div>
            </div>
            
            <div class="bg-gradient-to-r from-purple-500 to-purple-600 rounded-xl shadow-lg p-6 text-white">
                <div class="flex items-center">
                    <div class="p-3 rounded-full bg-purple-400 bg-opacity-30">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                        </svg>
                    </div>
                    <div class="ml-4">
                        <h2 class="text-lg font-semibold text-purple-100">Ticket Promedio</h2>
                        <p class="text-2xl font-bold text-white" id="ticket-promedio">$0</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Gráfico de ventas -->
        <div class="bg-white rounded-xl shadow-md p-6 mb-6">
            <h2 class="text-lg font-semibold text-gray-800 mb-4">Evolución de Ventas (Últimos 30 días)</h2>
            <div class="h-64">
                <canvas id="ventas-chart"></canvas>
            </div>
        </div>
    </div>
    
    <!-- Tabla de ventas -->
    <div class="bg-white rounded-xl shadow-lg overflow-hidden">
        <div class="px-6 py-4 border-b border-gray-200 flex flex-col md:flex-row md:items-center justify-between bg-gradient-to-r from-gray-50 to-gray-100">
            <h2 class="text-lg font-semibold text-gray-800 mb-2 md:mb-0">Lista de Ventas</h2>
            <div class="flex flex-col sm:flex-row items-start sm:items-center space-y-2 sm:space-y-0 sm:space-x-4">
                <div class="flex items-center space-x-2">
                    <span id="active-filters-count" class="hidden bg-blue-100 text-blue-800 text-xs font-medium px-2.5 py-0.5 rounded-full">0 filtros activos</span>
                    <button id="clear-filters" class="hidden text-sm text-gray-500 hover:text-gray-700">Limpiar filtros</button>
                </div>
                <div class="flex items-center space-x-2">
                    <label for="per-page-select" class="text-sm text-gray-600">Mostrar:</label>
                    <select id="per-page-select" class="text-sm border border-gray-300 rounded-md px-2 py-1 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="10">10</option>
                        <option value="20" selected>20</option>
                        <option value="50">50</option>
                        <option value="100">100</option>
                    </select>
                    <span class="text-sm text-gray-600">por página</span>
                </div>
            </div>
        </div>
        
        <!-- Contenedor con efecto de carga -->
        <div class="relative">
            <!-- Overlay de carga -->
            <div id="loading-overlay" class="absolute inset-0 bg-white bg-opacity-70 flex items-center justify-center z-10 hidden">
                <div class="text-center">
                    <div class="inline-block animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500 mb-4"></div>
                    <p class="text-gray-700 font-medium">Cargando ventas...</p>
                </div>
            </div>
            
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gradient-to-r from-gray-800 to-gray-900 text-white">
                        <tr>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">
                                Cliente
                            </th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">
                                Fecha
                            </th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">
                                Total
                            </th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">
                                Estado
                            </th>
                            <th scope="col" class="px-6 py-3 text-right text-xs font-medium uppercase tracking-wider">
                                Acciones
                            </th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200" id="ventas-table-body">
                        <!-- Las filas se cargarán dinámicamente -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Mensaje cuando no hay ventas -->
        <div id="no-ventas-message" class="hidden text-center py-12">
            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
            </svg>
            <h3 class="mt-2 text-sm font-medium text-gray-900">No se encontraron ventas</h3>
            <p class="mt-1 text-sm text-gray-500">Intenta ajustar los filtros de búsqueda.</p>
        </div>
        
        <!-- Paginación -->
        <div class="bg-gray-50 px-4 py-3 flex flex-col items-center justify-between border-t border-gray-200 sm:px-6" id="pagination-container">
            <!-- La paginación se cargará dinámicamente -->
        </div>
    </div>
</div>
<!-- Botón flotante para filtros -->
<button id="filter-toggle-btn" class="fixed bottom-6 right-6 w-16 h-16 bg-gradient-to-r from-blue-600 to-indigo-700 text-white rounded-full shadow-xl flex items-center justify-center z-30 transition-all duration-300 transform hover:scale-110 focus:outline-none focus:ring-4 focus:ring-blue-300 animate-pulse-slow">
    <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path>
    </svg>
</button>
<!-- Overlay para móvil y desktop -->
<div id="overlay" class="fixed inset-0 bg-black bg-opacity-60 z-40 hidden transition-opacity duration-300"></div>
<!-- Panel de filtros lateral -->
<div id="filter-panel" class="fixed top-0 right-0 h-full w-80 md:w-96 bg-white shadow-2xl z-50 transform translate-x-full transition-transform duration-300 ease-in-out overflow-y-auto">
    <div class="p-6 bg-gradient-to-b from-white to-gray-50 h-full">
        <!-- Encabezado del menú -->
        <div class="flex justify-between items-center mb-8 pb-4 border-b border-gray-200">
            <div>
                <h2 class="text-2xl font-bold text-gray-800 flex items-center">
                    <svg class="w-6 h-6 mr-2 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path>
                    </svg>
                    Filtros de Búsqueda
                </h2>
                <p class="text-gray-500 text-sm mt-1">Refina tus resultados</p>
            </div>
            <button id="close-filter-panel" class="text-gray-500 hover:text-gray-700 focus:outline-none rounded-full p-2 hover:bg-gray-100 transition-colors duration-200">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>
        
        <div class="flex-1">
            <form id="filter-form">
                <!-- Filtro por cliente -->
                <div class="filter-section mb-6">
                    <label class="block text-sm font-semibold text-gray-700 mb-2 flex items-center">
                        <svg class="w-4 h-4 mr-2 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                        Cliente
                    </label>
                    <input type="text" id="cliente" name="cliente" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 shadow-sm" placeholder="Nombre o número">
                </div>
                
                <!-- Filtro por fechas -->
                <div class="filter-section mb-6">
                    <label class="block text-sm font-semibold text-gray-700 mb-2 flex items-center">
                        <svg class="w-4 h-4 mr-2 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                        Rango de Fechas
                    </label>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="fecha_inicio" class="block text-xs text-gray-500 mb-1">Fecha Inicio</label>
                            <input type="date" id="fecha_inicio" name="fecha_inicio" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label for="fecha_fin" class="block text-xs text-gray-500 mb-1">Fecha Fin</label>
                            <input type="date" id="fecha_fin" name="fecha_fin" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                </div>
                
                <!-- Filtro por rango de montos -->
                <div class="filter-section mb-6">
                    <label class="block text-sm font-semibold text-gray-700 mb-2 flex items-center">
                        <svg class="w-4 h-4 mr-2 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        Rango de Montos
                    </label>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="monto_min" class="block text-xs text-gray-500 mb-1">Mínimo</label>
                            <div class="relative">
                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                    <span class="text-gray-500 sm:text-sm">$</span>
                                </div>
                                <input type="number" id="monto_min" name="monto_min" class="pl-7 w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="0">
                            </div>
                        </div>
                        <div>
                            <label for="monto_max" class="block text-xs text-gray-500 mb-1">Máximo</label>
                            <div class="relative">
                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                    <span class="text-gray-500 sm:text-sm">$</span>
                                </div>
                                <input type="number" id="monto_max" name="monto_max" class="pl-7 w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="1000000">
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Filtro por ordenamiento -->
                <div class="filter-section mb-6">
                    <label class="block text-sm font-semibold text-gray-700 mb-2 flex items-center">
                        <svg class="w-4 h-4 mr-2 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4h13M3 8h9m-9 4h9m5-4v12m0 0l-4-4m4 4l4-4"></path>
                        </svg>
                        Ordenar por
                    </label>
                    <div class="custom-select-container">
                        <div class="custom-select" data-name="sort_by">
                            <div class="custom-select-trigger">
                                <span class="custom-select-value">Fecha (más reciente primero)</span>
                                <svg class="custom-select-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </div>
                            <div class="custom-select-options">
                                <div class="custom-select-option selected" data-value="created_at">Fecha (más reciente primero)</div>
                                <div class="custom-select-option" data-value="created_at_asc">Fecha (más antiguo primero)</div>
                                <div class="custom-select-option" data-value="total">Monto (mayor a menor)</div>
                                <div class="custom-select-option" data-value="total_asc">Monto (menor a mayor)</div>
                                <div class="custom-select-option" data-value="cliente">Cliente (A-Z)</div>
                                <div class="custom-select-option" data-value="cliente_desc">Cliente (Z-A)</div>
                            </div>
                        </div>
                    </div>
                    <!-- Input oculto para almacenar el valor seleccionado -->
                    <input type="hidden" id="sort_by" name="sort_by" value="created_at">
                </div>
                
                <!-- Botón de acción -->
                <div class="pt-6 border-t border-gray-200 mt-8 flex justify-center">
                    <button type="button" id="reset-filters" class="flex items-center justify-center px-8 py-3 bg-gradient-to-r from-gray-200 to-gray-300 text-gray-800 rounded-xl hover:from-gray-300 hover:to-gray-400 transition-all duration-300 transform hover:scale-105 shadow-lg focus:outline-none focus:ring-4 focus:ring-gray-300 font-semibold">
                        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                        </svg>
                        Limpiar Filtros
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
<!-- Modal para ver detalles de venta -->
<div id="venta-detail-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center hidden z-modal-top">
    <div class="relative bg-white rounded-2xl shadow-2xl w-11/12 md:w-3/4 lg:w-2/3 max-h-[90vh] overflow-hidden transform transition-all duration-300 scale-95 opacity-0" id="modal-content">
        <!-- Encabezado con gradiente -->
        <div class="bg-gradient-to-r from-blue-600 to-indigo-700 p-6 text-white">
            <div class="flex justify-between items-center">
                <div class="flex items-center">
                    <div class="p-3 bg-white bg-opacity-20 rounded-xl mr-4">
                        <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path>
                        </svg>
                    </div>
                    <div>
                        <h3 class="text-2xl font-bold">Detalles de la Venta</h3>
                        <p class="text-blue-100 mt-1">Información completa de la transacción</p>
                    </div>
                </div>
                <button id="close-modal" class="text-white hover:text-blue-200 transition-colors duration-200 p-2 rounded-full hover:bg-white hover:bg-opacity-10">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
        </div>
        
        <!-- Contenido con scroll -->
        <div class="overflow-y-auto max-h-[calc(90vh-180px)] p-6" id="venta-detail-content">
            <!-- El contenido se cargará dinámicamente -->
        </div>
        
        <!-- Pie con botones de acción -->
        <div class="bg-gray-50 px-6 py-4 border-t border-gray-200 flex justify-end space-x-3">
            <button id="print-detail" class="px-4 py-2 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-lg hover:from-green-600 hover:to-green-700 transition-all duration-200 flex items-center">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path>
                </svg>
                Imprimir Factura
            </button>
            <button id="close-modal-btn" class="px-4 py-2 bg-gradient-to-r from-gray-500 to-gray-600 text-white rounded-lg hover:from-gray-600 hover:to-gray-700 transition-all duration-200 flex items-center">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
                Cerrar
            </button>
        </div>
    </div>
</div>

<style>
    body.no-scroll {
        overflow: hidden;
    }
    /* Animación de pulso lenta para el botón flotante */
    @keyframes pulse-slow {
        0% {
            box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7);
        }
        70% {
            box-shadow: 0 0 0 10px rgba(59, 130, 246, 0);
        }
        100% {
            box-shadow: 0 0 0 0 rgba(59, 130, 246, 0);
        }
    }
    
    .animate-pulse-slow {
        animation: pulse-slow 3s infinite;
    }
    
    /* Estilos para los selects personalizados */
    .custom-select-container {
        position: relative;
        width: 100%;
    }
    
    .custom-select {
        position: relative;
        width: 100%;
    }
    
    .custom-select-trigger {
        display: flex;
        justify-content: space-between;
        align-items: center;
        width: 100%;
        padding: 0.75rem 1rem;
        background-color: white;
        border: 1px solid #d1d5db;
        border-radius: 0.5rem;
        cursor: pointer;
        transition: all 0.2s ease;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
    }
    
    .custom-select-trigger:hover {
        border-color: #9ca3af;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }
    
    .custom-select-trigger:focus {
        outline: none;
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
    }
    
    .custom-select-value {
        display: block;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        font-weight: 500;
    }
    
    .custom-select-arrow {
        width: 1.25rem;
        height: 1.25rem;
        flex-shrink: 0;
        transition: transform 0.3s ease;
        color: #6b7280;
    }
    
    .custom-select.open .custom-select-arrow {
        transform: rotate(180deg);
    }
    
    .custom-select-options {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        margin-top: 0.5rem;
        background-color: white;
        border: 1px solid #e5e7eb;
        border-radius: 0.5rem;
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        z-index: 10;
        opacity: 0;
        visibility: hidden;
        transform: translateY(-10px);
        transition: all 0.3s ease;
        max-height: 200px;
        overflow-y: auto;
        scrollbar-width: thin;
        scrollbar-color: #d1d5db #f3f4f6;
    }
    
    .custom-select.open .custom-select-options {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
    }
    
    .custom-select-option {
        padding: 0.75rem 1rem;
        cursor: pointer;
        transition: all 0.2s ease;
        border-radius: 0.25rem;
        margin: 0.25rem;
    }
    
    .custom-select-option:hover {
        background-color: #f3f4f6;
    }
    
    .custom-select-option.selected {
        background-color: #eff6ff;
        color: #1d4ed8;
        font-weight: 600;
    }
    
    /* Estilos para el scrollbar */
    .custom-select-options::-webkit-scrollbar {
        width: 8px;
    }
    
    .custom-select-options::-webkit-scrollbar-track {
        background: #f3f4f6;
        border-radius: 4px;
    }
    
    .custom-select-options::-webkit-scrollbar-thumb {
        background: #d1d5db;
        border-radius: 4px;
    }
    
    .custom-select-options::-webkit-scrollbar-thumb:hover {
        background: #9ca3af;
    }
    
    /* Estilos para las secciones de filtros */
    .filter-section {
        position: relative;
        padding-bottom: 1rem;
    }
    
    .filter-section:not(:last-child)::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 1px;
        background: linear-gradient(to right, transparent, #e5e7eb, transparent);
    }
    
    /* Estilos para la modal de detalles */
    #venta-detail-modal.active #modal-content {
        transform: scale(1);
        opacity: 1;
    }
    
    /* Estilos para las tarjetas de información */
    .info-card {
        background: linear-gradient(to bottom right, #ffffff, #f9fafb);
        border-radius: 1rem;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        overflow: hidden;
        transition: all 0.3s ease;
    }
    
    .info-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }
    
    .info-card-header {
        background: linear-gradient(to right, #f3f4f6, #e5e7eb);
        padding: 0.75rem 1rem;
        border-bottom: 1px solid #e5e7eb;
    }
    
    .info-card-body {
        padding: 1rem;
    }
    
    /* Estilos para la tabla de productos */
    .product-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        border-radius: 0.75rem;
        overflow: hidden;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }
    
    .product-table thead th {
        background: linear-gradient(to right, #4b5563, #374151);
        color: white;
        padding: 0.75rem 1rem;
        text-align: left;
        font-weight: 600;
        font-size: 0.875rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }
    
    .product-table tbody tr:nth-child(odd) {
        background-color: #f9fafb;
    }
    
    .product-table tbody tr:nth-child(even) {
        background-color: #ffffff;
    }
    
    .product-table tbody tr:hover {
        background-color: #f3f4f6;
    }
    
    .product-table td {
        padding: 0.75rem 1rem;
        border-top: 1px solid #e5e7eb;
    }
    
    /* Estilos para el resumen de la venta */
    .summary-card {
        background: linear-gradient(135deg, #3b82f6, #1d4ed8);
        border-radius: 1rem;
        color: white;
        padding: 1.5rem;
        box-shadow: 0 10px 15px -3px rgba(59, 130, 246, 0.3), 0 4px 6px -2px rgba(59, 130, 246, 0.2);
    }
    
    .summary-item {
        display: flex;
        justify-content: space-between;
        padding: 0.5rem 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .summary-item:last-child {
        border-bottom: none;
        font-weight: 700;
        font-size: 1.25rem;
        margin-top: 0.5rem;
        padding-top: 1rem;
    }
</style>
<!-- Scripts necesarios -->
<script>
   // Función de inicialización global para que el SPA pueda llamarla
window.initializePage = function() {
    // Variables globales
    let ventasChart;
    let currentFilterParams = new URLSearchParams(window.location.search);
    let debounceTimer;
    let currentPage = 1;
    let currentPerPage = 20;
    
    // Función para formatear moneda
    function formatCurrency(value) {
        if (!value) return '$ 0';
        return '$ ' + parseFloat(value).toLocaleString('es-CO', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
    }
    
    // Función para formatear fecha
    function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString('es-CO', { year: 'numeric', month: 'short', day: 'numeric' });
    }
    
    
    
    // Función para mostrar/ocultar el overlay de carga
    function toggleLoadingOverlay(show) {
        const loadingOverlay = document.getElementById('loading-overlay');
        if (!loadingOverlay) return;
        
        if (show) {
            loadingOverlay.classList.remove('hidden');
        } else {
            loadingOverlay.classList.add('hidden');
        }
    }
    
    // Función para cargar estadísticas
    async function loadEstadisticas() {
        try {
            const response = await fetch(`/admin/api/ventas/estadisticas?${currentFilterParams.toString()}`);
            const data = await response.json();
            
            if (data.success) {
                // Animar los cambios en las estadísticas
                animateValue('total-ventas', parseInt(document.getElementById('total-ventas').textContent.replace(/\D/g, '')), data.estadisticas.total_ventas, 1000);
                animateValue('total-ingresos', parseInt(document.getElementById('total-ingresos').textContent.replace(/\D/g, '')), data.estadisticas.total_ingresos, 1000, true);
                animateValue('ticket-promedio', parseInt(document.getElementById('ticket-promedio').textContent.replace(/\D/g, '')), data.estadisticas.ticket_promedio, 1000, true);
                
                // Actualizar gráfico
                updateVentasChart(data.estadisticas.grafico);
            } else {
                window.toast.error('Error al cargar estadísticas');
            }
        } catch (error) {
            console.error('Error al cargar estadísticas:', error);
            window.toast.error('Error al cargar estadísticas');
        }
    }
    
    // Función para animar valores numéricos
    function animateValue(id, start, end, duration, isCurrency = false) {
        const element = document.getElementById(id);
        if (!element) return;
        
        const range = end - start;
        const increment = range / (duration / 16);
        let current = start;
        
        const timer = setInterval(() => {
            current += increment;
            if ((increment > 0 && current >= end) || (increment < 0 && current <= end)) {
                element.textContent = isCurrency ? formatCurrency(end) : end;
                clearInterval(timer);
            } else {
                element.textContent = isCurrency ? formatCurrency(Math.round(current)) : Math.round(current);
            }
        }, 16);
    }
    
    // Función para inicializar o actualizar el gráfico de ventas
    function updateVentasChart(graficoData) {
        const canvas = document.getElementById('ventas-chart');
        if (!canvas) return;
        
        const ctx = canvas.getContext('2d');
        
        if (ventasChart) {
            ventasChart.destroy();
        }
        
        ventasChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: graficoData.fechas,
                datasets: [
                    {
                        label: 'Ventas',
                        data: graficoData.cantidades,
                        borderColor: 'rgb(59, 130, 246)',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.3,
                        fill: true,
                        yAxisID: 'y'
                    },
                    {
                        label: 'Ingresos ($)',
                        data: graficoData.totales,
                        borderColor: 'rgb(16, 185, 129)',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        tension: 0.3,
                        fill: true,
                        yAxisID: 'y1'
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                interaction: {
                    mode: 'index',
                    intersect: false,
                },
                plugins: {
                    legend: {
                        position: 'top',
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                let label = context.dataset.label || '';
                                if (label) {
                                    label += ': ';
                                }
                                if (context.parsed.y !== null) {
                                    if (context.datasetIndex === 0) {
                                        label += context.parsed.y + ' ventas';
                                    } else {
                                        label += formatCurrency(context.parsed.y);
                                    }
                                }
                                return label;
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        type: 'linear',
                        display: true,
                        position: 'left',
                        title: {
                            display: true,
                            text: 'Cantidad de Ventas'
                        }
                    },
                    y1: {
                        type: 'linear',
                        display: true,
                        position: 'right',
                        title: {
                            display: true,
                            text: 'Ingresos ($)'
                        },
                        grid: {
                            drawOnChartArea: false,
                        },
                    }
                }
            }
        });
    }
    
    // Función para cargar ventas
    async function loadVentas(page = 1, perPage = currentPerPage, showLoading = true) {
        try {
            // Mostrar overlay de carga
            if (showLoading) {
                toggleLoadingOverlay(true);
            }
            
            // Actualizar parámetros de página y elementos por página
            currentPage = page;
            currentPerPage = perPage;
            currentFilterParams.set('page', page);
            currentFilterParams.set('per_page', perPage);
            
            const response = await fetch(`/admin/api/ventas?${currentFilterParams.toString()}`);
            const data = await response.json();
            
            if (data.success) {
                // Efecto de desvanecimiento
                const tableBody = document.getElementById('ventas-table-body');
                if (tableBody) {
                    tableBody.style.opacity = '0.5';
                    
                    setTimeout(() => {
                        renderVentasTable(data.ventas);
                        renderPagination(data.pagination);
                        
                        if (data.ventas.length === 0) {
                            const noVentasMessage = document.getElementById('no-ventas-message');
                            if (noVentasMessage) noVentasMessage.classList.remove('hidden');
                        } else {
                            const noVentasMessage = document.getElementById('no-ventas-message');
                            if (noVentasMessage) noVentasMessage.classList.add('hidden');
                        }
                        
                        // Restaurar opacidad
                        tableBody.style.opacity = '1';
                    }, 300);
                }
            } else {
                window.toast.error('Error al cargar ventas');
            }
        } catch (error) {
            console.error('Error al cargar ventas:', error);
            window.toast.error('Error al cargar ventas');
        } finally {
            // Ocultar overlay de carga
            if (showLoading) {
                setTimeout(() => {
                    toggleLoadingOverlay(false);
                }, 500);
            }
        }
    }
    
    // Función para renderizar la tabla de ventas
    function renderVentasTable(ventas) {
        const tableBody = document.getElementById('ventas-table-body');
        if (!tableBody) return;
        
        tableBody.innerHTML = '';
        
        ventas.forEach((venta, index) => {
            const row = document.createElement('tr');
            
            // Determinar clase de estado
            let estadoClass = '';
            if (venta.estado === 'activo') {
                estadoClass = 'bg-green-100 text-green-800';
            } else {
                estadoClass = 'bg-red-100 text-red-800';
            }
            
            // Añadir animación de aparición escalonada
            row.style.opacity = '0';
            row.style.transform = 'translateY(20px)';
            row.style.transition = `opacity 0.3s ease ${index * 0.05}s, transform 0.3s ease ${index * 0.05}s`;
            
            row.innerHTML = `
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                    <div class="flex items-center">
                        <div class="flex-shrink-0 h-10 w-10 bg-blue-100 rounded-full flex items-center justify-center">
                            <span class="text-blue-800 font-medium">${venta.usuario_nombre ? venta.usuario_nombre.charAt(0).toUpperCase() : 'N'}</span>
                        </div>
                        <div class="ml-4">
                            <div class="text-sm font-medium text-gray-900">${venta.usuario_nombre || 'N/A'}</div>
                            <div class="text-sm text-gray-500">${venta.usuario ? venta.usuario.numero : ''}</div>
                        </div>
                    </div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                    ${formatDate(venta.created_at)}
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                    ${formatCurrency(venta.total)}
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${estadoClass}">
                        ${venta.estado}
                    </span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                    <button class="text-blue-600 hover:text-blue-900 mr-3 view-detail-btn" data-id="${venta.id}">
                        Ver Detalle
                    </button>
                    <button class="text-${venta.estado === 'activo' ? 'red' : 'green'}-600 hover:text-${venta.estado === 'activo' ? 'red' : 'green'}-900 toggle-status-btn" data-id="${venta.id}" data-status="${venta.estado}">
                        ${venta.estado === 'activo' ? 'Inactivar' : 'Activar'}
                    </button>
                </td>
            `;
            
            tableBody.appendChild(row);
            
            // Activar animación después de añadir al DOM
            setTimeout(() => {
                row.style.opacity = '1';
                row.style.transform = 'translateY(0)';
            }, 50);
        });
        
        // Agregar eventos a los botones
        document.querySelectorAll('.view-detail-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const ventaId = this.getAttribute('data-id');
                showVentaDetail(ventaId);
            });
        });
        
        document.querySelectorAll('.toggle-status-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const ventaId = this.getAttribute('data-id');
                const currentStatus = this.getAttribute('data-status');
                const newStatus = currentStatus === 'activo' ? 'inactivo' : 'activo';
                toggleVentaStatus(ventaId, newStatus);
            });
        });
    }
    
    // Función para renderizar la paginación
    function renderPagination(pagination) {
        const container = document.getElementById('pagination-container');
        if (!container) return;
        
        container.innerHTML = '';
        
        if (pagination.pages <= 1) return;
        
        const paginationDiv = document.createElement('div');
        paginationDiv.className = 'flex flex-col items-center w-full';
        
        // Información de paginación - Solo mostrar elementos por página
        const endItem = Math.min(pagination.page * pagination.per_page, pagination.total);
        
        let paginationHTML = `
            <div class="text-sm text-gray-700 mb-4">
                Mostrando <span class="font-medium">${endItem}</span> de 
                <span class="font-medium">${pagination.total}</span> resultados
            </div>
            
            <div class="flex justify-center w-full">
                <!-- Navegación de página -->
                <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px" aria-label="Pagination">
        `;
        
        // Botón anterior
        paginationHTML += `
            <button id="prev-page" class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 ${!pagination.has_prev ? 'cursor-not-allowed opacity-50' : ''}" ${!pagination.has_prev ? 'disabled' : ''}>
                <span class="sr-only">Anterior</span>
                <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                    <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" />
                </svg>
            </button>
        `;
        
        // Determinar el rango de páginas a mostrar
        let startPage = Math.max(1, pagination.page - 2);
        let endPage = Math.min(pagination.pages, startPage + 4);
        
        if (endPage - startPage < 4) {
            startPage = Math.max(1, endPage - 4);
        }
        
        // Botón de primera página si no está en el rango
        if (startPage > 1) {
            paginationHTML += `
                <button class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700 hover:bg-gray-50" data-page="1">
                    1
                </button>
            `;
            
            if (startPage > 2) {
                paginationHTML += `
                    <span class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700">
                        ...
                    </span>
                `;
            }
        }
        
        // Números de página
        for (let i = startPage; i <= endPage; i++) {
            const isActive = i === pagination.page;
            paginationHTML += `
                <button class="relative inline-flex items-center px-4 py-2 border text-sm font-medium ${isActive ? 'z-10 bg-blue-50 border-blue-500 text-blue-600' : 'bg-white border-gray-300 text-gray-500 hover:bg-gray-50'}" data-page="${i}">
                    ${i}
                </button>
            `;
        }
        
        // Botón de última página si no está en el rango
        if (endPage < pagination.pages) {
            if (endPage < pagination.pages - 1) {
                paginationHTML += `
                    <span class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700">
                        ...
                    </span>
                `;
            }
            
            paginationHTML += `
                <button class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700 hover:bg-gray-50" data-page="${pagination.pages}">
                    ${pagination.pages}
                </button>
            `;
        }
        
        // Botón siguiente
        paginationHTML += `
            <button id="next-page" class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 ${!pagination.has_next ? 'cursor-not-allowed opacity-50' : ''}" ${!pagination.has_next ? 'disabled' : ''}>
                <span class="sr-only">Siguiente</span>
                <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                    <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
                </svg>
            </button>
        `;
        
        paginationHTML += `
                </nav>
            </div>
            
            <!-- Selector de página para móviles -->
            <div class="flex items-center mt-4 sm:hidden">
                <label for="mobile-page-select" class="mr-2 text-sm text-gray-700">Página:</label>
                <select id="mobile-page-select" class="text-sm border border-gray-300 rounded-md px-2 py-1 focus:outline-none focus:ring-2 focus:ring-blue-500">
        `;
        
        // Opciones para el selector de página móvil
        for (let i = 1; i <= pagination.pages; i++) {
            paginationHTML += `<option value="${i}" ${i === pagination.page ? 'selected' : ''}>${i}</option>`;
        }
        
        paginationHTML += `
                </select>
                <span class="ml-2 text-sm text-gray-700">de ${pagination.pages}</span>
            </div>
        `;
        
        paginationDiv.innerHTML = paginationHTML;
        container.appendChild(paginationDiv);
        
        // Agregar eventos a los botones de paginación
        const prevPageBtn = document.getElementById('prev-page');
        if (prevPageBtn) {
            prevPageBtn.addEventListener('click', () => {
                if (pagination.has_prev) {
                    loadVentas(pagination.prev_num, currentPerPage);
                }
            });
        }
        
        const nextPageBtn = document.getElementById('next-page');
        if (nextPageBtn) {
            nextPageBtn.addEventListener('click', () => {
                if (pagination.has_next) {
                    loadVentas(pagination.next_num, currentPerPage);
                }
            });
        }
        
        // Eventos a los números de página
        document.querySelectorAll('[data-page]').forEach(btn => {
            btn.addEventListener('click', function() {
                const page = parseInt(this.getAttribute('data-page'));
                loadVentas(page, currentPerPage);
            });
        });
        
        // Evento para el selector de página móvil
        const mobilePageSelect = document.getElementById('mobile-page-select');
        if (mobilePageSelect) {
            mobilePageSelect.addEventListener('change', function() {
                const page = parseInt(this.value);
                loadVentas(page, currentPerPage);
            });
        }
    }
    
    // Función para mostrar detalles de venta
    async function showVentaDetail(ventaId) {
        try {
            const response = await fetch(`/admin/api/ventas/${ventaId}`);
            const data = await response.json();
            
            if (data.success) {
                const venta = data.venta;
                const modal = document.getElementById('venta-detail-modal');
                const content = document.getElementById('venta-detail-content');
                
                if (!modal || !content) return;
                
                let productosHTML = '';
                venta.productos.forEach(producto => {
                    productosHTML += `
                        <tr>
                            <td class="px-4 py-3 border-b">${producto.producto_nombre}</td>
                            <td class="px-4 py-3 border-b text-center">${producto.cantidad}</td>
                            <td class="px-4 py-3 border-b text-right">${formatCurrency(producto.precio_unitario)}</td>
                            <td class="px-4 py-3 border-b text-right font-medium">${formatCurrency(producto.subtotal)}</td>
                        </tr>
                    `;
                });
                
                content.innerHTML = `
                    <!-- Elemento oculto para almacenar el ID de la venta -->
                    <div data-venta-id="${venta.id}" style="display: none;"></div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                        <!-- Información de la venta -->
                        <div class="lg:col-span-2">
                            <div class="info-card h-full">
                                <div class="info-card-header">
                                    <h3 class="text-lg font-semibold text-gray-800 flex items-center">
                                        <svg class="w-5 h-5 mr-2 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path>
                                        </svg>
                                        Información de la Venta
                                    </h3>
                                </div>
                                <div class="info-card-body">
                                    <div class="grid grid-cols-2 gap-4">
                                        <div>
                                            <p class="text-sm text-gray-500">ID de Venta</p>
                                            <p class="font-medium text-lg">#${venta.id.toString().padStart(6, '0')}</p>
                                        </div>
                                        <div>
                                            <p class="text-sm text-gray-500">Fecha</p>
                                            <p class="font-medium">${formatDate(venta.created_at)}</p>
                                        </div>
                                        <div>
                                            <p class="text-sm text-gray-500">Estado</p>
                                            <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${venta.estado_pedido === 'completado' ? 'bg-green-100 text-green-800' : venta.estado_pedido === 'pendiente' ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800'}">
                                                ${venta.estado_pedido}
                                            </span>
                                        </div>
                                        <div>
                                            <p class="text-sm text-gray-500">Método de Pago</p>
                                            <p class="font-medium">${venta.metodo_pago || 'Contra Entrega'}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Resumen de la venta -->
                        <div>
                            <div class="summary-card h-full">
                                <h3 class="text-lg font-semibold mb-4 flex items-center">
                                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                    Resumen
                                </h3>
                                <div class="summary-item">
                                    <span>Subtotal:</span>
                                    <span>${formatCurrency(venta.total)}</span>
                                </div>
                                <div class="summary-item">
                                    <span>Impuestos:</span>
                                    <span>${formatCurrency(venta.impuestos)}</span>
                                </div>
                                <div class="summary-item">
                                    <span>Descuentos:</span>
                                    <span>${formatCurrency(venta.descuentos)}</span>
                                </div>
                                <div class="summary-item">
                                    <span>Total:</span>
                                    <span>${formatCurrency(venta.total)}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Información del cliente -->
                    <div class="info-card mb-8">
                        <div class="info-card-header">
                            <h3 class="text-lg font-semibold text-gray-800 flex items-center">
                                <svg class="w-5 h-5 mr-2 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                </svg>
                                Información del Cliente
                            </h3>
                        </div>
                        <div class="info-card-body">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <p class="text-sm text-gray-500">Nombre Completo</p>
                                    <p class="font-medium">${venta.usuario.nombre} ${venta.usuario.apellido}</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-500">Número de Contacto</p>
                                    <p class="font-medium">${venta.usuario.numero}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Productos -->
                    <div>
                        <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                            <svg class="w-5 h-5 mr-2 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path>
                            </svg>
                            Productos Comprados
                        </h3>
                        <div class="overflow-x-auto">
                            <table class="product-table w-full">
                                <thead>
                                    <tr>
                                        <th>Producto</th>
                                        <th class="text-center">Cantidad</th>
                                        <th class="text-right">Precio Unitario</th>
                                        <th class="text-right">Subtotal</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${productosHTML}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
                
                // Mostrar modal con animación
                modal.classList.remove('hidden');
                setTimeout(() => {
                    modal.classList.add('active');
                }, 10);
            } else {
                window.toast.error('Error al cargar detalles de la venta');
            }
        } catch (error) {
            console.error('Error al cargar detalles de la venta:', error);
            window.toast.error('Error al cargar detalles de la venta');
        }
    }
    
    // Función para cambiar el estado de una venta
    async function toggleVentaStatus(ventaId, newStatus) {
        try {
            const response = await fetch(`/admin/api/ventas/${ventaId}/estado`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': document.querySelector('meta[name="csrf-token"]')?.getAttribute('content')
                },
                body: JSON.stringify({ estado: newStatus })
            });
            
            const data = await response.json();
            
            if (data.success) {
                window.toast.success(`La venta ha sido marcada como ${newStatus} correctamente`);
                // Recargar la lista de ventas
                loadVentas(currentPage, currentPerPage);
            } else {
                window.toast.error(data.message || 'Error al cambiar el estado de la venta');
            }
        } catch (error) {
            console.error('Error al cambiar estado de la venta:', error);
            window.toast.error('Error al cambiar el estado de la venta', 'error');
        }
    }
    
    // Función para contar filtros activos
    function countActiveFilters() {
        let count = 0;
        const cliente = document.getElementById('cliente')?.value || '';
        const fecha_inicio = document.getElementById('fecha_inicio')?.value || '';
        const fecha_fin = document.getElementById('fecha_fin')?.value || '';
        const monto_min = document.getElementById('monto_min')?.value || '';
        const monto_max = document.getElementById('monto_max')?.value || '';
        const sort_by = document.getElementById('sort_by')?.value || 'created_at';
        
        if (cliente) count++;
        if (fecha_inicio) count++;
        if (fecha_fin) count++;
        if (monto_min) count++;
        if (monto_max) count++;
        if (sort_by !== 'created_at') count++;
        
        return count;
    }
    
    // Función para actualizar indicadores de filtros
    function updateFilterIndicators() {
        const activeFiltersCount = countActiveFilters();
        const activeFiltersElement = document.getElementById('active-filters-count');
        const clearFiltersElement = document.getElementById('clear-filters');
        
        if (activeFiltersCount > 0) {
            if (activeFiltersElement) {
                activeFiltersElement.textContent = `${activeFiltersCount} filtros activos`;
                activeFiltersElement.classList.remove('hidden');
            }
            if (clearFiltersElement) {
                clearFiltersElement.classList.remove('hidden');
            }
        } else {
            if (activeFiltersElement) {
                activeFiltersElement.classList.add('hidden');
            }
            if (clearFiltersElement) {
                clearFiltersElement.classList.add('hidden');
            }
        }
    }
    
    // Función para aplicar filtros automáticamente
    function applyFilters() {
        // Actualizar parámetros de filtro
        currentFilterParams = new URLSearchParams();
        const cliente = document.getElementById('cliente')?.value || '';
        const fecha_inicio = document.getElementById('fecha_inicio')?.value || '';
        const fecha_fin = document.getElementById('fecha_fin')?.value || '';
        const monto_min = document.getElementById('monto_min')?.value || '';
        const monto_max = document.getElementById('monto_max')?.value || '';
        const sort_by = document.getElementById('sort_by')?.value || 'created_at';
        
        if (cliente) currentFilterParams.set('cliente', cliente);
        if (fecha_inicio) currentFilterParams.set('fecha_inicio', fecha_inicio);
        if (fecha_fin) currentFilterParams.set('fecha_fin', fecha_fin);
        if (monto_min) currentFilterParams.set('monto_min', monto_min);
        if (monto_max) currentFilterParams.set('monto_max', monto_max);
        if (sort_by !== 'created_at') currentFilterParams.set('sort_by', sort_by);
        
        // Actualizar indicadores de filtros
        updateFilterIndicators();
        
        // Recargar ventas y estadísticas
        loadVentas(1, currentPerPage, true);
        loadEstadisticas();
    }
    
    // Evento para cerrar modal
    const closeModalBtn = document.getElementById('close-modal');
    const closeModalBtnFooter = document.getElementById('close-modal-btn');
    const modal = document.getElementById('venta-detail-modal');
    
    if (closeModalBtn && modal) {
        closeModalBtn.addEventListener('click', function() {
            modal.classList.remove('active');
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        });
    }
    
    if (closeModalBtnFooter && modal) {
        closeModalBtnFooter.addEventListener('click', function() {
            modal.classList.remove('active');
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        });
    }
    
    // Evento para imprimir detalles
    const printBtn = document.getElementById('print-detail');
    if (printBtn) {
        printBtn.addEventListener('click', function() {
            // Obtener el ID de la venta actual del modal
            const modal = document.getElementById('venta-detail-modal');
            if (modal) {
                // Buscar el ID de la venta en el contenido del modal
                const ventaIdElement = modal.querySelector('[data-venta-id]');
                if (ventaIdElement) {
                    const ventaId = ventaIdElement.getAttribute('data-venta-id');
                    if (ventaId) {
                        // Abrir una nueva ventana con la URL de impresión
                        const printWindow = window.open(`/admin/api/ventas/${ventaId}/imprimir`, '_blank');
                        if (printWindow) {
                            printWindow.focus();
                        } else {
                            window.toast.error('No se pudo abrir la ventana de impresión. Verifica que tu navegador permita ventanas emergentes.', 'error');
                        }
                    }
                } else {
                    window.toast.error('No se encontró el ID de la venta para imprimir', 'error');
                }
            }
        });
    }
    
    // Evento para abrir/cerrar panel de filtros
    const filterToggleBtn = document.getElementById('filter-toggle-btn');
    const filterPanel = document.getElementById('filter-panel');
    const overlay = document.getElementById('overlay');
    
    if (filterToggleBtn && filterPanel && overlay) {
        filterToggleBtn.addEventListener('click', function() {
            filterPanel.classList.remove('translate-x-full');
            overlay.classList.remove('hidden');
            document.body.classList.add('no-scroll'); // Deshabilita el scroll del body
        });
        
        // Cerrar panel al hacer clic en el overlay
        overlay.addEventListener('click', function() {
            filterPanel.classList.add('translate-x-full');
            overlay.classList.add('hidden');
            document.body.classList.remove('no-scroll'); // Habilita el scroll del body
        });
        
        // Cerrar panel al hacer clic en el botón de cerrar
        const closeFilterPanelBtn = document.getElementById('close-filter-panel');
        if (closeFilterPanelBtn) {
            closeFilterPanelBtn.addEventListener('click', function() {
                filterPanel.classList.add('translate-x-full');
                overlay.classList.add('hidden');
                document.body.classList.remove('no-scroll'); // Habilita el scroll del body
            });
        }
    }
    
    // Eventos para filtros automáticos (con debounce)
    const clienteInput = document.getElementById('cliente');
    if (clienteInput) {
        clienteInput.addEventListener('input', function() {
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(function() {
                applyFilters();
            }, 500); // Esperar 500ms después de que el usuario deje de escribir
        });
    }
    
    const fechaInicioInput = document.getElementById('fecha_inicio');
    if (fechaInicioInput) {
        fechaInicioInput.addEventListener('change', function() {
            applyFilters();
        });
    }
    
    const fechaFinInput = document.getElementById('fecha_fin');
    if (fechaFinInput) {
        fechaFinInput.addEventListener('change', function() {
            applyFilters();
        });
    }
    
    const montoMinInput = document.getElementById('monto_min');
    if (montoMinInput) {
        montoMinInput.addEventListener('input', function() {
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(function() {
                applyFilters();
            }, 500); // Esperar 500ms después de que el usuario deje de escribir
        });
    }
    
    const montoMaxInput = document.getElementById('monto_max');
    if (montoMaxInput) {
        montoMaxInput.addEventListener('input', function() {
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(function() {
                applyFilters();
            }, 500); // Esperar 500ms después de que el usuario deje de escribir
        });
    }
    
    // Evento para el select personalizado de ordenamiento
    const customSelects = document.querySelectorAll('.custom-select');
    customSelects.forEach(select => {
        const trigger = select.querySelector('.custom-select-trigger');
        const options = select.querySelector('.custom-select-options');
        const value = select.querySelector('.custom-select-value');
        
        if (trigger && options && value) {
            trigger.addEventListener('click', function() {
                // Cerrar otros selects abiertos
                customSelects.forEach(s => {
                    if (s !== select) {
                        s.classList.remove('open');
                    }
                });
                
                select.classList.toggle('open');
            });
            
            // Manejar selección de opciones
            const optionElements = options.querySelectorAll('.custom-select-option');
            optionElements.forEach(option => {
                option.addEventListener('click', function() {
                    // Actualizar valor seleccionado
                    optionElements.forEach(opt => opt.classList.remove('selected'));
                    this.classList.add('selected');
                    
                    // Actualizar texto mostrado
                    value.textContent = this.textContent;
                    
                    // Actualizar valor del input oculto si existe
                    const name = select.getAttribute('data-name');
                    if (name) {
                        const hiddenInput = document.getElementById(name);
                        if (hiddenInput) {
                            hiddenInput.value = this.getAttribute('data-value');
                        }
                    }
                    
                    // Aplicar filtros si es el select de ordenamiento
                    if (name === 'sort_by') {
                        applyFilters();
                    }
                    
                    // Cerrar el select
                    select.classList.remove('open');
                });
            });
        }
    });
    
    // Cerrar selects al hacer clic fuera
    document.addEventListener('click', function(event) {
        customSelects.forEach(select => {
            if (!select.contains(event.target)) {
                select.classList.remove('open');
            }
        });
    });
    
    // Evento para selector de elementos por página
    const perPageSelect = document.getElementById('per-page-select');
    if (perPageSelect) {
        perPageSelect.addEventListener('change', function() {
            const perPage = parseInt(this.value);
            currentPerPage = perPage;
            loadVentas(1, perPage, true);
        });
    }
    
    // Evento para restablecer filtros
    const resetFiltersBtn = document.getElementById('reset-filters');
    if (resetFiltersBtn) {
        resetFiltersBtn.addEventListener('click', function() {
            const filterForm = document.getElementById('filter-form');
            if (filterForm) filterForm.reset();
            
            // Resetear el select personalizado
            const sortBySelect = document.querySelector('.custom-select[data-name="sort_by"]');
            if (sortBySelect) {
                const firstOption = sortBySelect.querySelector('.custom-select-option');
                if (firstOption) {
                    firstOption.click();
                }
            }
            
            // Asegurarse de que el input oculto se restablezca también
            const sortByInput = document.getElementById('sort_by');
            if (sortByInput) {
                sortByInput.value = 'created_at';
            }
            
            currentFilterParams = new URLSearchParams();
            updateFilterIndicators();
            
            // Recargar ventas y estadísticas con efecto de carga
            loadVentas(1, currentPerPage, true);
            loadEstadisticas();
            
        });
    }
    
    // Evento para limpiar filtros desde la tabla
    const clearFiltersBtn = document.getElementById('clear-filters');
    if (clearFiltersBtn) {
        clearFiltersBtn.addEventListener('click', function() {
            const filterForm = document.getElementById('filter-form');
            if (filterForm) filterForm.reset();
            
            // Resetear el select personalizado
            const sortBySelect = document.querySelector('.custom-select[data-name="sort_by"]');
            if (sortBySelect) {
                const firstOption = sortBySelect.querySelector('.custom-select-option');
                if (firstOption) {
                    firstOption.click();
                }
            }
            
            // Asegurarse de que el input oculto se restablezca también
            const sortByInput = document.getElementById('sort_by');
            if (sortByInput) {
                sortByInput.value = 'created_at';
            }
            
            currentFilterParams = new URLSearchParams();
            updateFilterIndicators();
            
            // Recargar ventas y estadísticas con efecto de carga
            loadVentas(1, currentPerPage, true);
            loadEstadisticas();
            
        });
    }
    
    // Evento para botón de actualizar
    const refreshBtn = document.getElementById('refresh-btn');
    if (refreshBtn) {
        refreshBtn.addEventListener('click', function() {
            // Recargar ventas y estadísticas con efecto de carga
            loadVentas(currentPage, currentPerPage, true);
            loadEstadisticas();
            
        });
    }
    
    // Cargar datos iniciales
    loadVentas(1, currentPerPage, false); // Sin efecto de carga inicial
    loadEstadisticas();
    
    // Establecer valores iniciales de los filtros
    const cliente = currentFilterParams.get('cliente');
    const fecha_inicio = currentFilterParams.get('fecha_inicio');
    const fecha_fin = currentFilterParams.get('fecha_fin');
    const monto_min = currentFilterParams.get('monto_min');
    const monto_max = currentFilterParams.get('monto_max');
    const sort_by = currentFilterParams.get('sort_by');
    const per_page = currentFilterParams.get('per_page');
    
    if (cliente) {
        const clienteInput = document.getElementById('cliente');
        if (clienteInput) clienteInput.value = cliente;
    }
    if (fecha_inicio) {
        const fechaInicioInput = document.getElementById('fecha_inicio');
        if (fechaInicioInput) fechaInicioInput.value = fecha_inicio;
    }
    if (fecha_fin) {
        const fechaFinInput = document.getElementById('fecha_fin');
        if (fechaFinInput) fechaFinInput.value = fecha_fin;
    }
    if (monto_min) {
        const montoMinInput = document.getElementById('monto_min');
        if (montoMinInput) montoMinInput.value = monto_min;
    }
    if (monto_max) {
        const montoMaxInput = document.getElementById('monto_max');
        if (montoMaxInput) montoMaxInput.value = monto_max;
    }
    if (sort_by) {
        // Buscar la opción correspondiente en el select personalizado
        const sortBySelect = document.querySelector('.custom-select[data-name="sort_by"]');
        if (sortBySelect) {
            const options = sortBySelect.querySelectorAll('.custom-select-option');
            options.forEach(option => {
                if (option.getAttribute('data-value') === sort_by) {
                    option.click();
                }
            });
        }
        
        // También establecer el valor del input oculto
        const sortByInput = document.getElementById('sort_by');
        if (sortByInput) {
            sortByInput.value = sort_by;
        }
    }
    if (per_page) {
        const perPageSelect = document.getElementById('per-page-select');
        if (perPageSelect) {
            perPageSelect.value = per_page;
            currentPerPage = parseInt(per_page);
        }
    }
    
    // Actualizar indicadores de filtros
    updateFilterIndicators();
};
// Si el evento DOMContentLoaded ya ha ocurrido, inicializar la página inmediatamente
if (document.readyState === 'complete' || document.readyState === 'interactive') {
    window.initializePage();
} else {
    document.addEventListener('DOMContentLoaded', window.initializePage);
}
</script>
{% endblock %}