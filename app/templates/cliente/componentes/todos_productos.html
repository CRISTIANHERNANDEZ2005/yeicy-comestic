{% extends 'cliente/page/base.html' %} 
{% block title %} Productos - YE&CI COMESTIC{% endblock %} 
{% block content %}
<main class="container mx-auto px-4 py-8">
  <!-- Header mejorado -->
  <div class="mb-8">
    <div class="flex flex-col md:flex-row md:items-center justify-between mb-6">
      <div class="mb-4 md:mb-0">
        <h1 id="category-title" class="text-3xl md:text-4xl font-bold text-gray-900 mb-3">
          Todos los Productos
        </h1>
        <p id="category-description" class="text-gray-600 text-base md:text-lg max-w-2xl">
          Descubre nuestra exclusiva selección de productos de alta calidad
        </p>
      </div>
      <div>
        <div
          id="breadcrumbs"
          class="inline-flex items-center space-x-2 text-sm bg-white px-4 py-2.5 rounded-lg shadow-sm border border-gray-100"
        >
          <a
            href="/"
            class="text-pink-600 hover:text-pink-800 transition-colors duration-200 flex items-center"
          >
            <i class="fas fa-home mr-1.5 text-sm"></i> Inicio
          </a>
          <span class="text-gray-300">/</span>
          <span class="text-gray-700 font-medium">Productos</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Controles superiores mejorados -->
  <div
    class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4 bg-white p-5 rounded-2xl shadow-sm border border-gray-100"
  >
    <div class="flex items-center gap-3 flex-wrap">
      <div class="bg-pink-50 px-4 py-2.5 rounded-xl border border-pink-100">
        <span class="text-gray-700 font-medium"
          >Mostrando
          <span id="product-count" class="text-pink-600 font-bold">0</span> de
          <span id="total-product-count" class="text-pink-600 font-bold"
            >0</span
          >
          productos</span
        >
      </div>
      <!-- Botón de filtros unificado para móvil y desktop -->
      <button
        id="filter-btn"
        class="bg-pink-600 text-white px-4 py-2.5 rounded-xl flex items-center hover:bg-pink-700 transition-colors duration-300 shadow-md hover:shadow-lg"
      >
        <i class="fas fa-filter mr-2"></i> Filtros
      </button>
    </div>
    <div class="flex flex-wrap gap-3">
      <div class="relative">
        <select
          id="sort-select"
          class="appearance-none bg-white border border-gray-200 rounded-xl py-2.5 pl-4 pr-10 text-gray-700 focus:outline-none focus:ring-2 focus:ring-pink-500 focus:border-transparent shadow-sm transition-all duration-200 hover:border-gray-300"
        >
          <option value="newest" selected>Más Nuevos</option>
          <option value="az">De la A a la Z</option>
          <option value="za">De la Z a la A</option>
          <option value="price_asc">Precio: Menor a Mayor</option>
          <option value="price_desc">Precio: Mayor a Menor</option>
          <option value="top_rated">Mejor Valorados</option>
        </select>
        <div
          class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-3 text-gray-500"
        >
          <i class="fas fa-chevron-down text-sm"></i>
        </div>
      </div>
      <button
        id="clear-filters"
        class="bg-white text-gray-700 px-4 py-2.5 rounded-xl hover:bg-gray-50 transition-colors duration-200 font-medium shadow-sm border border-gray-200 hover:border-gray-300 flex items-center"
      >
        <i class="fas fa-sync-alt mr-2 text-sm"></i> Limpiar
      </button>
    </div>
  </div>

  <!-- Contenedor de filtros aplicados -->
  <div id="applied-filters" class="mb-6 hidden"></div>

  <div class="flex flex-col md:flex-row gap-8">
    <!-- Contenido principal de productos mejorado -->
    <div class="flex-1">
      <div id="product-listing-container">
        <!-- Estado de Carga (Skeleton) mejorado -->
        <div
          id="product-grid-loader"
          class="grid grid-cols-1 xs:grid-cols-2 sm:grid-cols-2 lg:grid-cols-4 gap-5 md:gap-6 w-full"
        >
          {% for i in range(6) %}
          <div
            class="product-skeleton bg-white rounded-2xl shadow-lg overflow-hidden animate-pulse border border-gray-100"
          >
            <div class="relative overflow-hidden aspect-square bg-gradient-to-br from-gray-100 to-gray-200 rounded-t-2xl"></div>
            <div class="p-5 space-y-3">
              <div class="h-4 w-1/3 bg-gray-200 rounded-full"></div>
              <div class="h-5 w-3/4 bg-gray-200 rounded"></div>
              <div class="h-4 w-full bg-gray-200 rounded"></div>
              <div class="flex justify-between items-center pt-3">
                <div class="h-6 w-1/4 bg-gray-200 rounded"></div>
                <div class="h-9 w-1/3 bg-gray-200 rounded-xl"></div>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>

        <!-- Grid de productos (inicialmente oculto) -->
        <div
          id="product-grid"
          class="grid grid-cols-1 xs:grid-cols-2 sm:grid-cols-2 lg:grid-cols-4 gap-5 md:gap-6"
          style="display: none"
        >
          <!-- Los productos se cargarán aquí dinámicamente -->
        </div>

        <!-- Botones de paginación "Ver más" / "Ver menos" -->
        <div id="pagination-buttons" class="mt-12 flex flex-col items-center space-y-4">
          <button
            id="load-more-btn"
            class="bg-pink-600 text-white px-6 py-3 rounded-xl flex items-center justify-center hover:bg-pink-700 transition-colors duration-300 shadow-md hover:shadow-lg text-lg font-semibold w-full md:w-auto"
            style="display: none;"
          >
            <i class="fas fa-arrow-down mr-2"></i> Ver más productos
          </button>
          <button
            id="show-less-btn"
            class="bg-gray-200 text-gray-700 px-6 py-3 rounded-xl flex items-center justify-center hover:bg-gray-300 transition-colors duration-300 shadow-md hover:shadow-lg text-lg font-semibold w-full md:w-auto"
            style="display: none;"
          >
            <i class="fas fa-arrow-up mr-2"></i> Ver menos productos
          </button>
        </div>
      </div>

      {% include 'cliente/componentes/no_results.html' %}
    </div>
  </div>
</main>

<!-- Drawer de filtros unificado para móvil y desktop -->
<div
  id="filter-drawer"
  class="drawer hidden fixed inset-y-0 right-0 z-[999] w-80 md:w-96 bg-white shadow-xl overflow-y-auto"
>
  <div class="p-6">
    <div class="flex justify-between items-center mb-6">
      <h3 class="text-xl font-bold text-gray-800 flex items-center">
        <i class="fas fa-sliders-h text-pink-600 mr-2"></i> Filtros
      </h3>
      <button id="close-filter-btn" class="text-gray-500 hover:text-gray-700">
        <i class="fas fa-times text-xl"></i>
      </button>
    </div>

    <!-- Contenido del drawer -->
    <div class="space-y-6">
      <!-- Filtro por Categoría -->
      <div>
        <h4
          class="filter-toggle font-medium text-gray-800 mb-3 flex items-center justify-between cursor-pointer bg-gray-50 p-3.5 rounded-xl hover:bg-gray-100 transition-colors duration-200 border border-gray-100"
          data-target="category-filters-content"
        >
          <span class="flex items-center">
            <i class="fas fa-folder-open text-pink-600 mr-3 text-sm"></i> 
            <span class="font-semibold">Categoría</span>
          </span>
          <i
            class="fas fa-chevron-down text-xs text-gray-500 transform transition-transform duration-200"
          ></i>
        </h4>
        <div
          id="category-filters-content"
          class="space-y-2 custom-scrollbar max-h-52 overflow-y-auto pr-2 mt-3 pl-1 hidden"
        >
          <label
            class="flex items-center p-2.5 hover:bg-pink-50 rounded-xl cursor-pointer transition-colors duration-200"
          >
            <input
              type="radio"
              name="category"
              value="all"
              class="rounded-full text-pink-600 focus:ring-pink-500 border-gray-300"
              checked
            />
            <span class="ml-3 text-gray-700 font-medium">Todas las categorías</span>
          </label>
          {% for categoria in categorias %}
          <label
            class="flex items-center p-2.5 hover:bg-pink-50 rounded-xl cursor-pointer transition-colors duration-200"
          >
            <input
              type="radio"
              name="category"
              value="{{ categoria.nombre }}"
              class="rounded-full text-pink-600 focus:ring-pink-500 border-gray-300"
            />
            <span class="ml-3 text-gray-700">{{ categoria.nombre }}</span>
          </label>
          {% endfor %}
        </div>
      </div>

      <!-- Filtro por Subcategoría -->
      <div>
        <h4
          class="filter-toggle font-medium text-gray-800 mb-3 flex items-center justify-between cursor-pointer bg-gray-50 p-3.5 rounded-xl hover:bg-gray-100 transition-colors duration-200 border border-gray-100"
          data-target="subcategory-filters-content"
        >
          <span class="flex items-center">
            <i class="fas fa-tags text-pink-600 mr-3 text-sm"></i> 
            <span class="font-semibold">Subcategoría</span>
          </span>
          <i
            class="fas fa-chevron-down text-xs text-gray-500 transform transition-transform duration-200"
          ></i>
        </h4>
        <div
          id="subcategory-filters-content"
          class="space-y-2 custom-scrollbar max-h-52 overflow-y-auto pr-2 mt-3 pl-1 hidden"
        >
          <label
            class="flex items-center p-2.5 hover:bg-pink-50 rounded-xl cursor-pointer transition-colors duration-200"
          >
            <input
              type="radio"
              name="subcategory"
              value="all"
              class="rounded-full text-pink-600 focus:ring-pink-500 border-gray-300"
              checked
            />
            <span class="ml-3 text-gray-700 font-medium">Todas las subcategorías</span>
          </label>
          {% for subcategoria in subcategorias %}
          <label
            class="flex items-center p-2.5 hover:bg-pink-50 rounded-xl cursor-pointer transition-colors duration-200"
          >
            <input
              type="radio"
              name="subcategory"
              value="{{ subcategoria.nombre }}"
              class="rounded-full text-pink-600 focus:ring-pink-500 border-gray-300"
            />
            <span class="ml-3 text-gray-700">{{ subcategoria.nombre }}</span>
          </label>
          {% endfor %}
        </div>
      </div>

      <!-- Filtro por Pseudocategoría -->
      <div>
        <h4
          class="filter-toggle font-medium text-gray-800 mb-3 flex items-center justify-between cursor-pointer bg-gray-50 p-3.5 rounded-xl hover:bg-gray-100 transition-colors duration-200 border border-gray-100"
          data-target="pseudocategory-filters-content"
        >
          <span class="flex items-center">
            <i class="fas fa-layer-group text-pink-600 mr-3 text-sm"></i>
            <span class="font-semibold">Pseudocategoría</span>
          </span>
          <i
            class="fas fa-chevron-down text-xs text-gray-500 transform transition-transform duration-200"
          ></i>
        </h4>
        <div
          id="pseudocategory-filters-content"
          class="space-y-2 custom-scrollbar max-h-52 overflow-y-auto pr-2 mt-3 pl-1 hidden"
        >
          <label
            class="flex items-center p-2.5 hover:bg-pink-50 rounded-xl cursor-pointer transition-colors duration-200"
          >
            <input
              type="radio"
              name="pseudocategory"
              value="all"
              class="rounded-full text-pink-600 focus:ring-pink-500 border-gray-300"
              checked
            />
            <span class="ml-3 text-gray-700 font-medium">Todas las pseudocategorías</span>
          </label>
          {% for seudocategoria in seudocategorias %}
          <label
            class="flex items-center p-2.5 hover:bg-pink-50 rounded-xl cursor-pointer transition-colors duration-200"
          >
            <input
              type="radio"
              name="pseudocategory"
              value="{{ seudocategoria.nombre }}"
              class="rounded-full text-pink-600 focus:ring-pink-500 border-gray-300"
            />
            <span class="ml-3 text-gray-700"
              >{{ seudocategoria.nombre }}</span
            >
          </label>
          {% endfor %}
        </div>
      </div>

      <!-- Filtro por Marca -->
      <div>
        <h4
          class="filter-toggle font-medium text-gray-800 mb-3 flex items-center justify-between cursor-pointer bg-gray-50 p-3.5 rounded-xl hover:bg-gray-100 transition-colors duration-200 border border-gray-100"
          data-target="brand-filters-content"
        >
          <span class="flex items-center">
            <i class="fas fa-copyright text-pink-600 mr-3 text-sm"></i>
            <span class="font-semibold">Marca</span>
          </span>
          <i
            class="fas fa-chevron-down text-xs text-gray-500 transform transition-transform duration-200"
          ></i>
        </h4>
        <div
          id="brand-filters-content"
          class="space-y-2 custom-scrollbar max-h-52 overflow-y-auto pr-2 mt-3 pl-1 hidden"
        >
          <label
            class="flex items-center p-2.5 hover:bg-pink-50 rounded-xl cursor-pointer transition-colors duration-200"
          >
            <input
              type="radio"
              name="brand"
              value="all"
              class="rounded-full text-pink-600 focus:ring-pink-500 border-gray-300"
              checked
            />
            <span class="ml-3 text-gray-700 font-medium">Todas las marcas</span>
          </label>
          {% for marca in marcas %}
          <label
            class="flex items-center p-2.5 hover:bg-pink-50 rounded-xl cursor-pointer transition-colors duration-200"
          >
            <input
              type="radio"
              name="brand"
              value="{{ marca }}"
              class="rounded-full text-pink-600 focus:ring-pink-500 border-gray-300"
            />
            <span class="ml-3 text-gray-700">{{ marca }}</span>
          </label>
          {% endfor %}
        </div>
      </div>

      <!-- Filtro por Género -->
      <div>
        <h4
          class="filter-toggle font-medium text-gray-800 mb-3 flex items-center justify-between cursor-pointer bg-gray-50 p-3.5 rounded-xl hover:bg-gray-100 transition-colors duration-200 border border-gray-100"
          data-target="gender-filters-content"
        >
          <span class="flex items-center">
            <i class="fas fa-venus-mars text-pink-600 mr-3 text-sm"></i>
            <span class="font-semibold">Género</span>
          </span>
          <i
            class="fas fa-chevron-down text-xs text-gray-500 transform transition-transform duration-200"
          ></i>
        </h4>
        <div
          id="gender-filters-content"
          class="space-y-2 custom-scrollbar max-h-52 overflow-y-auto pr-2 mt-3 pl-1 hidden"
        >
          <label class="flex items-center p-2.5 hover:bg-pink-50 rounded-xl cursor-pointer transition-colors duration-200">
            <input type="radio" name="gender" value="all" class="rounded-full text-pink-600 focus:ring-pink-500 border-gray-300" checked />
            <span class="ml-3 text-gray-700 font-medium">Todos los géneros</span>
          </label>
          {% for genero in generos %}
          <label class="flex items-center p-2.5 hover:bg-pink-50 rounded-xl cursor-pointer transition-colors duration-200">
            <input type="radio" name="gender" value="{{ genero }}" class="rounded-full text-pink-600 focus:ring-pink-500 border-gray-300" />
            <span class="ml-3 text-gray-700">{{ genero }}</span>
          </label>
          {% endfor %}
        </div>
      </div>

      <!-- MEJORA PROFESIONAL: Filtro por Función -->
      <div>
        <h4
          class="filter-toggle font-medium text-gray-800 mb-3 flex items-center justify-between cursor-pointer bg-gray-50 p-3.5 rounded-xl hover:bg-gray-100 transition-colors duration-200 border border-gray-100"
          data-target="function-filters-content"
        >
          <span class="flex items-center">
            <i class="fas fa-cogs text-pink-600 mr-3 text-sm"></i>
            <span class="font-semibold">Función</span>
          </span>
          <i
            class="fas fa-chevron-down text-xs text-gray-500 transform transition-transform duration-200"
          ></i>
        </h4>
        <div
          id="function-filters-content"
          class="space-y-2 custom-scrollbar max-h-52 overflow-y-auto pr-2 mt-3 pl-1 hidden"
        >
          <label class="flex items-center p-2.5 hover:bg-pink-50 rounded-xl cursor-pointer transition-colors duration-200">
            <input type="radio" name="function" value="all" class="rounded-full text-pink-600 focus:ring-pink-500 border-gray-300" checked />
            <span class="ml-3 text-gray-700 font-medium">Todas las funciones</span>
          </label>
        </div>
      </div>
      
      <!-- Filtro de precio -->
      <div>
        <h4
          class="filter-toggle font-medium text-gray-800 mb-3 flex items-center justify-between cursor-pointer bg-gray-50 p-3.5 rounded-xl hover:bg-gray-100 transition-colors duration-200 border border-gray-100"
          data-target="price-filters-content"
        >
          <span class="flex items-center">
            <i class="fas fa-dollar-sign text-pink-600 mr-3 text-sm"></i> 
            <span class="font-semibold">Rango de Precio</span>
          </span>
          <i
            class="fas fa-chevron-down text-xs text-gray-500 transform transition-transform duration-200"
          ></i>
        </h4>
        <div id="price-filters-content" class="mt-4 px-1 space-y-4 hidden">
          <div class="flex items-center justify-between gap-3">
            <div class="relative w-1/2">
              <input
                type="number"
                id="min-price"
                name="min_price"
                placeholder="Mín."
                min="0"
                class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500"
              />
            </div>
            <div class="text-gray-500">-</div>
            <div class="relative w-1/2">
              <input
                type="number"
                id="max-price"
                name="max_price"
                placeholder="Máx."
                min="0"
                class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500"
              />
            </div>
          </div>
          <div class="flex justify-between text-sm text-gray-600">
            <span id="min-price-label">$0</span>
            <span id="max-price-label">$0</span>
          </div>
        </div>
      </div>

      <!-- Botones de acción -->
      <div class="flex flex-col gap-3 pt-4">
        <button
          id="reset-filters"
          class="border border-gray-300 text-gray-700 font-medium py-2.5 rounded-lg hover:bg-gray-50 transition duration-300"
        >
          Restablecer
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Overlay para cerrar el modal al hacer clic fuera -->
<div
  id="filter-modal-overlay"
  class="fixed inset-0 bg-black bg-opacity-50 z-[998] hidden transition-opacity duration-300"
></div>

<script>
  window.appData = {
    categorias: {{ categorias | tojson }},
    subcategorias: {{ subcategorias | tojson }},
    seudocategorias: {{ seudocategorias | tojson }},
    marcas: {{ marcas | tojson }},
    generos: {{ generos | tojson }},
    funciones: {{ funciones | tojson }}
  };
</script>

<style>
  /* Personalización de scrollbar */
  .custom-scrollbar::-webkit-scrollbar {
    width: 6px;
  }
  .custom-scrollbar::-webkit-scrollbar-track {
    background: #f8f9fa;
    border-radius: 10px;
  }
  .custom-scrollbar::-webkit-scrollbar-thumb {
    background: #e9ecef;
    border-radius: 10px;
  }
  .custom-scrollbar::-webkit-scrollbar-thumb:hover {
    background: #dee2e6;
  }

  /* Animación del drawer móvil */
  .drawer {
    transform: translateX(100%);
    transition: transform 0.3s ease-in-out;
  }
  .drawer.open {
    transform: translateX(0);
  }

  /* Efecto hover en productos */
  .product-card {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }
  .product-card:hover {
    transform: scale(1.03);
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    z-index: 10;
  }

  /* Animación para filtros */
  .filter-toggle i {
    transition: transform 0.2s ease;
  }
  .filter-toggle.active i {
    transform: rotate(180deg);
  }

  /* Estilos para los filtros */
  .filter-section {
    border-bottom: 1px solid #f3f4f6;
    padding-bottom: 1rem;
    margin-bottom: 1rem;
  }

  /* Efectos hover en los filtros */
  .filter-option {
    transition: background-color 0.2s ease;
  }
  .filter-option:hover {
    background-color: #f9fafb;
  }

  /* Estilos para los botones */
  .btn-primary {
    background: linear-gradient(to right, #ec4899, #db2777);
    color: white;
    transition: all 0.3s ease;
  }
  .btn-primary:hover {
    background: linear-gradient(to right, #db2777, #ec4899);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(219, 39, 119, 0.25);
  }

  /* Estilos para la paginación */
  .pagination a {
    transition: all 0.2s ease;
  }
  .pagination a:hover {
    background-color: #fdf2f8;
    color: #ec4899;
  }
  .pagination a.active {
    background-color: #ec4899;
    color: white;
  }
  
  /* Mejoras responsivas */
  @media (max-width: 639px) {
    .xs\:grid-cols-2 {
      grid-template-columns: repeat(2, minmax(0, 1fr));
    }
  }
  
  /* Efectos de transición generales */
  * {
    transition-property: color, background-color, border-color, transform, box-shadow;
    transition-duration: 200ms;
    transition-timing-function: ease;
  }

  /* --- Estilos para la animación profesional --- */

  /* Clases para desvanecer elementos */
  .fade-out {
    opacity: 0;
    transition: opacity 0.3s ease-out;
  }

  .fade-in {
    opacity: 1;
    transition: opacity 0.3s ease-in;
  }

  /* Animación para la entrada de las tarjetas */
  @keyframes card-enter {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .card-enter {
    animation: card-enter 0.4s ease-out forwards;
  }

</style>
<script src="{{ url_for('static', filename='js/product_card.js') }}"></script>
<script src="{{ url_for('static', filename='js/todos_productos.js') }}"></script>

{% endblock %}