<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>{% block title %}YE&CI COMESTIC{% endblock %}</title>
        <!-- Tailwind CSS CDN -->
        <script src="https://cdn.tailwindcss.com"></script>
        <!-- imagen de la pagina -->
        <link rel="icon" type="image/png" href="{{ url_for('static', filename='imagenes/yc-logo.svg') }}">
        <!-- Font Awesome CDN -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

        <!-- Interceptor de autenticación -->
        <script src="{{ url_for('static', filename='js/auth_interceptor.js') }}"></script>

        <!-- importar el archivo de estilos -->
        <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    </head>

    <body class="bg-gray-100 font-sans flex flex-col min-h-screen" {% if 'user' in session %} data-user-id="{{ session.user.id }}" {% endif %}>
        {% include 'cliente/ui/auth_modals.html' %}

        <!-- Navbar principal -->
        <div class="w-full">
            <div class="bg-white border-b-2 border-pink-200 shadow-xl sticky top-0 z-50">
                <nav
                    class="sticky top-0 z-50 w-full shadow-xl border-b-2 border-pink-200 flex flex-col md:flex-row items-stretch md:items-center justify-between px-4 md:px-8 transition-all duration-300 animate-fade-in-down bg-white py-4" style="opacity: 1" role="navigation" aria-label="Navegación principal">

                    <!-- Contenido principal de la barra de navegación -->
                    <!-- Fila superior: Logo + Íconos -->
                    <div class="flex items-center justify-between w-full">
                        <!-- Logo -->
                        <div class="flex items-center">
                            <a href="/" class="flex items-center gap-2 group focus:outline-none" aria-label="Inicio" tabindex="0">
                                <span class="relative select-none" style="letter-spacing: 0.04em">
                                    <span class="font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-pink-500 via-pink-400 to-fuchsia-500 drop-shadow-md transition-all duration-300 text-xl sm:text-2xl md:text-3xl tracking-wider group-hover:from-fuchsia-500 group-hover:to-pink-500 group-hover:drop-shadow-lg">
                                        <span class="hidden sm:inline">Ye&Cy Cosmetic</span>
                                        <span class="sm:hidden">Ye&Cy Cosmetic</span>
                                    </span>
                                    <span class="absolute -top-2 -right-6 md:-right-8 animate-pulse">
                                        <svg class="w-5 h-5 md:w-6 md:h-6 text-pink-400 group-hover:text-fuchsia-500 transition-colors" fill="currentColor" viewbox="0 0 20 20">
                                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.286 3.967a1 1 0 00.95.69h4.175c.969 0 1.371 1.24.588 1.81l-3.38 2.455a1 1 0 00-.364 1.118l1.287 3.966c.3.922-.755 1.688-1.54 1.118l-3.38-2.454a1 1 0 00-1.175 0l-3.38 2.454c-.784.57-1.838-.196-1.54-1.118l1.287-3.966a1 1 0 00-.364-1.118L2.049 9.394c-.783-.57-.38-1.81.588-1.81h4.175a1 1 0 00.95-.69l1.286-3.967z"/>
                                        </svg>
                                    </span>
                                    <span class="absolute left-0 -bottom-1 w-0 h-1 bg-gradient-to-r from-pink-400 to-fuchsia-400 rounded-full group-hover:w-full transition-all duration-500"></span>
                                </span>
                            </a>
                        </div>

                        <!-- Buscador Desktop -->
                        <div class="hidden md:flex flex-1 max-w-xl mx-4">
                            {% include 'cliente/ui/buscador_desktop.html' %}
                        </div>

                        <!-- Iconos de acción (carrito, favoritos, usuario) -->
                        <div class="flex items-center gap-5 md:gap-6">
                            <!-- Favoritos -->
                            <div class="relative">
                                <a href="{{ url_for('favorites.favoritos') }}" id="navbar-fav-btn" class="p-2 rounded-full transition-all focus:outline-none focus:ring-2 focus:ring-pink-400 group bg-white/90 shadow-sm hover:bg-pink-50 hover:scale-110 mx-0.5 relative md:bg-transparent md:shadow-none" aria-label="Favoritos">
                                    <div class="relative">
                                        <svg class="w-7 h-7 md:w-8 md:h-8 text-pink-500 group-hover:text-pink-600 transition-colors" fill="none" stroke="currentColor" stroke-width="2.2" viewbox="0 0 24 24">
                                            <path d="M12 21C12 21 4 13.686 4 8.857C4 6.099 6.238 4 8.857 4C10.324 4 11.667 4.857 12 6.086C12.333 4.857 13.676 4 15.143 4C17.762 4 20 6.099 20 8.857C20 13.686 12 21 12 21Z" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                        <span id="favorites-counter" class="absolute -top-1.5 -right-1.5 bg-gradient-to-r from-pink-500 to-fuchsia-500 text-white text-xs font-bold rounded-full min-w-[1.5rem] h-6 flex items-center justify-center shadow-lg border-2 border-white ring-2 ring-pink-200 animate-bounce z-10 select-none transition-all duration-300 transform scale-0 opacity-0" aria-label="0 favoritos" title="Tus productos favoritos">
                                            0
                                        </span>
                                    </div>
                                </a>
                            </div>

                            <!-- Carrito -->
                            <div class="relative">
                                <button type="button" id="cartIcon" class="p-2 rounded-full transition-all focus:outline-none focus:ring-2 focus:ring-yellow-300 group bg-white/90 shadow-sm hover:bg-yellow-50 hover:scale-110 mx-0.5 relative md:bg-transparent md:shadow-none cursor-pointer" aria-label="Carrito">
                                    <div class="relative">
                                        <svg class="w-7 h-7 md:w-8 md:h-8 text-yellow-500 group-hover:text-yellow-600 transition-colors" fill="none" stroke="currentColor" stroke-width="2.2" viewbox="0 0 24 24">
                                            <circle cx="9" cy="21" r="1"/>
                                            <circle cx="20" cy="21" r="1"/>
                                            <path d="M1 1h2l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
                                        </svg>
                                        <span id="cartCounter" class="absolute -top-0.5 -right-0.5 bg-gradient-to-r from-yellow-500 to-orange-500 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center shadow-lg border-2 border-white transform transition-all duration-300 hover:scale-110">
                                            0
                                        </span>
                                    </div>
                                </button>
                            </div>

                            <!-- Menú usuario (desktop) -->
                            <div class="relative hidden md:block" role="navigation" aria-label="Menú de usuario premium">
                                <div class="ml-2 flex items-center">
                                    {% if 'user' in session %}
                                        <span id="navbarUserName" class="hidden md:inline-block mr-2 text-sm font-medium text-gray-700">
                                            Hola,
                                            {{ session.user.nombre.split(' ')[0] }}
                                        </span>
                                    {% endif %}
                                    {% include 'cliente/ui/menu_usuario.html' %}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Buscador Mobile -->
                        <div class="w-full px-4 py-2 md:hidden mt-2">
                            {% include 'cliente/ui/buscador_mobile.html' %}
                        </div>
                    </div>
                </nav>
            </div>

            <!-- Barra secundaria de categorías principales -->
            <div
                class="relative w-full" style="z-index: 20">
                <!-- Navbar de categorías Desktop -->
                <div class="hidden md:block">
                    {% include 'cliente/ui/navbar_categorias_desktop.html' %}
                </div>
                <!-- Navbar de categorías Mobile -->
                <div class="md:hidden">
                    {% include 'cliente/ui/navbar_categorias_mobile.html' %}
                </div>
            </div>
        </div>

        <!-- Contenido principal -->
        {% block full_width_content %}{% endblock %}

        <!-- Modal de advertencia de autenticación para LIKE -->
        <div id="like-auth-modal" class="fixed z-[9999] bottom-4 left-4 pointer-events-none" style="display:none;">
            <div id="like-auth-modal-inner" class="bg-pink-600 text-white rounded-xl shadow-2xl px-4 py-3 text-base font-semibold flex items-center gap-3 pointer-events-auto transform transition-all duration-300 ease-in-out animate-fade-in-up" style="min-width:220px;max-width:90vw;">
                <svg class="w-7 h-7 text-white flex-shrink-0" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12c0 4.97-4.03 9-9 9s-9-4.03-9-9 4.03-9 9-9 9 4.03 9 9z"/></svg>
                <span id="like-auth-modal-msg">Debes iniciar sesión para agregar productos a tus favoritos.</span>
                <a href="#" onclick="showAuthModal('login'); return false;" id="like-auth-login-btn" class="ml-4 bg-white text-pink-600 font-bold rounded-lg px-3 py-1 shadow hover:bg-pink-50 transition-colors duration-200 text-sm focus:outline-none focus:ring-2 focus:ring-pink-400" style="white-space:nowrap;">Iniciar sesión</a>
            </div>
        </div>

        <main class="container mx-auto pt-20 pb-8 px-4 flex-1">
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    <script>
                        document.addEventListener('DOMContentLoaded', function() {
                            {% for category, message in messages %}
                                let toastType = 'info'; // Default
                                if ({{ category|tojson }} === 'error' || {{ category|tojson }} === 'danger') {
                                    toastType = 'error';
                                } else if ({{ category|tojson }} === 'warning') {
                                    toastType = 'warning';
                                } else if ({{ category|tojson }} === 'success') {
                                    toastType = 'success';
                                }
                                window.toast.show({{ message|tojson }}, toastType);
                            {% endfor %}
                        });
                    </script>
                {% endif %}
            {% endwith %}
            {% block content %}{% endblock %}
        </main>

        {% block full_width_footer_content %}{% endblock %}

    <!-- WhatsApp Floating Button -->
    {% include 'cliente/ui/whatsapp_button.html' %}

    <!-- Footer -->
    {% include 'cliente/ui/footer.html' %}

    <!-- Bottom Navigation - Only on mobile -->
    {% include 'cliente/ui/mobile_nav.html' %}

    <!-- Incluir el carrito -->
    {% include 'cliente/ui/carrito.html' %}

    {% include 'cliente/ui/notifications.html' %}
    
    {% include 'cliente/ui/reseña_modals.html' %}

    {% include 'cliente/ui/mobile_menu.html' %}

    
    {% if 'user' in session %}
    {% include 'cliente/ui/modal_edicion_usuario.html' %}
    {% endif %}
    
    <!-- Scripts -->
    <script src="{{ url_for('static', filename='js/scripts.js') }}"></script>
    <script src="{{ url_for('static', filename='js/product_card.js') }}"></script>
    <script src="{{ url_for('static', filename='js/cart.js') }}"></script>
    <script src="{{ url_for('static', filename='js/auth_modals.js') }}"></script>
    <script src="{{ url_for('static', filename='js/favorites.js') }}"></script>
    <script>
        window.userId = {{ session.get('user_id') | tojson }};
        window.isAuthenticated = {{ 'true' if 'user' in session else 'false' }};

        // Listen for profileUpdated event and update navbarUserName
        window.addEventListener('profileUpdated', function(event) {
            const updatedUser = event.detail.user;
            const navbarUserNameElement = document.getElementById("navbarUserName");
            if (navbarUserNameElement) {
                navbarUserNameElement.textContent = "Hola, " + updatedUser.nombre.split(' ')[0];
            }
        });
    </script>
</body>
</html>
